<html>
  <head>
    <script>
    
      /*
       We only want to monitor updates to apps so the only known way to do this 
       at the moment is to listen as apps are uninstalled and then re-installed
       */
       
      var apps = {};
      
      var onInstall = function(ext) {
        if(ext.isApp) {
          apps[ext.name] = ext; 
        }
      };
      
      /*
        Track all the version numbers
      */
      var getAllCallback = function(exts) {
        for(var i in exts) {
          var ext = exts[i];
          
          if(ext.isApp) {
            apps[ext.id] = ext;
          }
        }
      };
      
      var inputChanged = function(text, suggestionsCallback) {
        
        if(text == "") {
          return;
        }
        
        var suggestions = [];
        var textlc = text.toLowerCase();
        var re = new RegExp("("+text+")","ig");
        
        for(var a in apps) {
          var app = apps[a];
          var name = app.name.toLowerCase();
          var idx = name.indexOf(textlc);
          if(idx > -1) {
            var content = app.name;
            var description = (app.description == "") ? " " : app.description;
            
            var matchStyle = chrome.omnibox.styleMatch(idx, text.length);
            //var style = description.replace(re, "<url>$1</url>");
            
            suggestions.push( 
              {
                "content": content,
                "description" : content + " - " + description,
                "descriptionStyles" : [
                  matchStyle
                ]
              }
            ); 
            
            /*suggestions.push( 
              {
                "content": content,
                "description" : "View in Webstore - " + description
                
              }
            );*/
          }
        }
  
        suggestionsCallback(suggestions);
      };
      
      var inputEntered = function(text) {
        
        var appsList = [];
        var defaultApp = null;
        
        if(text == "") {
          return;
        }
        
        for(var a in apps) {
          var app = apps[a];
          
          if(app.name.toLowerCase() == text.toLowerCase()) {
            chrome.management.launchApp(app.id);            
            return;
          }
          
        }
      };
      
      chrome.management.onInstalled.addListener(onInstall);
      chrome.management.getAll(getAllCallback);
      chrome.omnibox.onInputChanged.addListener(inputChanged);
      chrome.omnibox.onInputEntered.addListener(inputEntered);
      
    </script>
  </head>
  <body>
  </body>
</html>